$(function(){var a=$("#js_add_client"),e=$("#js_get_service"),t=$("#js_add_service"),i=$("#js_add_pres"),l=$("#js_add_waiting_fac");$(".add_value").on("click",function(){var a={mod:"addDepense",libel:$("#libel").val(),date:$("#date").val(),prix:$("#prix").val()};O.Ajax.addDepense(a)}),$(".js_btn_add_svc").button().on("click",function(){$("#js_add_service .name").html($(".cli_nom input").val()),$("#js_add_service .pname").html($(".cli_pname input").val()),$("#js_add_service .tech").html($(this).html()),$("#js_add_service .tech").attr("data-fam-num",$(this).data("fam-num")),t.dialog("open")}),$(".js_get_svc").on("click",function(){var a={mod:"getService",svc_num:$(this).data("svc-num")};O.Ajax.getService(a),$("#js_get_service #js_frm_service").attr("data-num",$(this).data("svc-num")),e.dialog("open")}),$(".js_add_client").on("click",function(){return a.dialog("open"),!1}),$(".js_btn_edit_client").on("click",function(){var a={mod:"editClient",cli_num:$("#cli_num").val(),cli_nom:$("#cli_nom").val(),cli_prenom:$("#cli_prenom").val(),cli_adr:$("#cli_adr").val(),cli_cp:$("#cli_cp").val(),cli_ville:$("#cli_ville").val(),cli_tel:$("#cli_tel").val(),cli_mobile:$("#cli_mobile").val(),cli_email:$("#cli_email").val(),cli_naiss:$("#cli_naiss").val(),cli_genre:$("#cli_genre option:selected").val(),cli_sexe:$("#cli_sexe option:selected").val()};O.Ajax.editClient(a)}),$(".js_btn_del_client").on("click",function(){var a={mod:"delClient",cli_num:$("#js_fiche_client div:first-child").data("cli")};O.Ajax.delClient(a)}),$(".js_btn_get_pres").on("click",function(){var a={mod:"getPres",fam_num:$(this).data("fam-num")};O.Ajax.getPres(a),$("#js_add_pres table").attr("data-fac-num",$(this).data("fam-num")),i.dialog("open")}),$(".js_pres_remise").on("focusout",function(){var a=$(this).val(),e=$(this).parents("tr").children("td").children(".pres_prix_applied"),t=0;e.val((parseFloat(parseFloat($(this).parents("tr").find(".pres_prix_base").html()))*(1-parseFloat(a)/100)).format(2,3," ",".")),$("tbody tr td input.pres_prix_applied").delay(1e3).each(function(){t=parseFloat(t)+parseFloat($(this).val())}),$(".total_applied").html(t.format(2,3," ","."))}),$(".pres_prix_applied").on("focusout",function(){var a=parseFloat($(this).val());$(this).val(a.format(2,3," ","."));var e=0;$("tbody tr td input.pres_prix_applied").delay(1e3).each(function(){e=parseFloat(e)+parseFloat($(this).val())}),$(".total_applied").html(e.format(2,3," ","."))}),$(".pres_prix_applied").on("dblclick",function(){$(this).removeAttr("readonly"),$(this).css("border","1px solid black")}),$(".js_btn_del_fac_pres").on("click",function(){var a=$(this).parents("tr"),e={mod:"delPresFac",fac_num:$("#js_facturation p:first-child").data("fac-num"),pres_num:a.data("pres-num")};return O.Ajax.delPresFac(e),!1}),$(".js_btn_validate_fac").on("click",function(){var a={1:parseFloat($("#cb").val()),2:parseFloat($("#cheque").val()),3:parseFloat($("#espece").val())};return O.Ajax.addPai({mod:"addPai",fac_num:$("#js_facturation p:first-child").data("fac-num"),montants_pai:a}),$("tbody tr").each(function(){O.Ajax.validateFac({mod:"validateFac",pres_num:$(this).data("pres-num"),fac_num:$(this).data("fac-num-lg"),pres_remise:parseFloat($(this).find("input.js_pres_remise").val()),pres_prix_base:parseFloat($(this).find(".pres_prix_base").html()),pres_prix_applied:parseFloat($(this).find("input.pres_prix_applied").val())})}),!1}),$("#cb, #cheque, #espece").on("focusout",function(){var a=0;isNaN(parseFloat($("#cb").val()))===!1&&(a+=parseFloat($("#cb").val())),isNaN(parseFloat($("#cheque").val()))===!1&&(a+=parseFloat($("#cheque").val())),isNaN(parseFloat($("#espece").val()))===!1&&(a+=parseFloat($("#espece").val()));var e=parseFloat($(".total_applied").html())-a;$(".rendu").html(e),$(".total_pai").html(a)}),$(".js_btn_del_fac").on("click",function(){var a={mod:"delFac",fac_num:$("#js_facturation p:first-child").data("fac-num")};return O.Ajax.delFac(a),!1}),$(".js_add_waiting_fac").on("click",function(){var a={mod:"getWaitingFac",fac_num:$("#js_facturation p:first-child").data("fac-num")};return O.Ajax.getWaitingFac(a),l.dialog("open"),!1}),$(".js_del_fac_included").on("click",function(){var a={mod:"delIncludedfac",fac_num:$(this).data("fac-included")};return O.Ajax.delIncludedFac(a),!1}),$(".js_back_search").on("click",function(){window.location.href="?p=search"}),$("header").on("click",function(){window.location.href="index.php"}),$(".datepicker").datepicker({changeMonth:!0,changeYear:!0,yearRange:"1920:2040"}),$(".datepicker").datepicker($.datepicker.regional.fr),$(".footable").footable().bind("footable_filtering",function(a){var e=$(".filter-status").find(":selected").text();e&&e.length>0&&(a.filter+=a.filter&&a.filter.length>0?" "+e:e,a.clear=!a.filter)}),$(".clear-filter").click(function(a){a.preventDefault(),$(".filter-status").val(""),$(".footable").trigger("footable_clear_filter")}),$("input[type=submit], button").button(),$(window).resize(function(){$(".ui-dialog-content:visible").dialog("option","position",$(".ui-dialog-content:visible").dialog("option","position"))})}),Number.prototype.format=function(a,e,t,i){var l="\\d(?=(\\d{"+(e||3)+"})+"+(a>0?"\\D":"$")+")",n=this.toFixed(Math.max(0,~~a));return(i?n.replace(".",i):n).replace(new RegExp(l,"g"),"$&"+(t||","))+" â‚¬"};